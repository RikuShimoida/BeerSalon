generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

/// ユーザープロフィール（Supabase Auth の auth.users に紐づく）
model UserProfile {
  id             String               @id @default(uuid()) @db.Uuid
  userAuthId     String               @unique @map("user_auth_id") @db.Uuid
  lastName       String               @map("last_name")
  firstName      String               @map("first_name")
  nickname       String
  birthday       DateTime             @db.Date
  gender         String
  prefecture     String
  profileImageUrl String?             @map("profile_image_url")
  bio            String?
  isActive       Boolean              @default(true) @map("is_active")
  createdAt      DateTime             @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt      DateTime             @updatedAt @map("updated_at") @db.Timestamptz(6)
  favoriteBars   FavoriteBar[]
  loginHistories LoginHistory[]
  notifications  Notification[]
  postLikes      PostLike[]
  posts          Post[]
  userCoupons    UserCoupon[]
  following      UserFollowRelation[] @relation("Followee")
  followedBy     UserFollowRelation[] @relation("Follower")
  viewHistories  ViewHistory[]

  @@map("user_profiles")
}

/// ビアバー基本情報
model Bar {
  id             BigInt        @id @default(autoincrement())
  name           String
  prefecture     String
  city           String
  addressLine1   String        @map("address_line1")
  addressLine2   String?       @map("address_line2")
  latitude       Decimal?      @db.Decimal(10, 7)
  longitude      Decimal?      @db.Decimal(10, 7)
  phoneNumber    String?       @map("phone_number")
  openingTime    DateTime?     @map("opening_time") @db.Time(6)
  endingTime     DateTime?     @map("ending_time") @db.Time(6)
  regularHoliday String?       @map("regular_holiday")
  access         String?
  websiteUrl     String?       @map("website_url")
  description    String?
  isActive       Boolean       @default(true) @map("is_active")
  createdAt      DateTime      @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt      DateTime      @updatedAt @map("updated_at") @db.Timestamptz(6)
  articles       Article[]
  beerMenus      BarBeerMenu[]
  foodMenus      BarFoodMenu[]
  barImages      BarImage[]
  coupons        Coupon[]
  favoriteBars   FavoriteBar[]
  posts          Post[]
  viewHistories  ViewHistory[]

  @@map("bars")
}

/// 店舗画像
model BarImage {
  id        BigInt   @id @default(autoincrement())
  barId     BigInt   @map("bar_id")
  imageType String   @map("image_type")
  imageUrl  String   @map("image_url")
  sortOrder Int      @default(0) @map("sort_order")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  bar       Bar      @relation(fields: [barId], references: [id], onDelete: Cascade)

  @@map("bar_images")
}

/// ビールカテゴリマスタ
model BeerCategory {
  id        BigInt   @id @default(autoincrement())
  name      String   @unique
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)
  beers     Beer[]

  @@map("beer_categories")
}

/// 国マスタ
model Country {
  id        BigInt   @id @default(autoincrement())
  name      String   @unique
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)
  origins   Origin[]

  @@map("countries")
}

/// 産地マスタ
model Origin {
  id        BigInt   @id @default(autoincrement())
  name      String
  countryId BigInt   @map("country_id")
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)
  beers     Beer[]
  country   Country  @relation(fields: [countryId], references: [id])

  @@unique([countryId, name])
  @@map("origins")
}

/// 醸造所マスタ
model Brewery {
  id         BigInt   @id @default(autoincrement())
  name       String   @unique
  country    String?
  region     String?
  websiteUrl String?  @map("website_url")
  isActive   Boolean  @default(true) @map("is_active")
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)
  beers      Beer[]

  @@map("breweries")
}

/// ビール銘柄マスタ
model Beer {
  id             BigInt        @id @default(autoincrement())
  name           String
  beerCategoryId BigInt        @map("beer_category_id")
  breweryId      BigInt?       @map("brewery_id")
  originId       BigInt?       @map("origin_id")
  abv            Decimal?      @db.Decimal(4, 2)
  ibu            Int?
  description    String?
  imageUrl       String?       @map("image_url")
  isActive       Boolean       @default(true) @map("is_active")
  createdAt      DateTime      @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt      DateTime      @updatedAt @map("updated_at") @db.Timestamptz(6)
  beerMenus      BarBeerMenu[]
  beerCategory   BeerCategory  @relation(fields: [beerCategoryId], references: [id])
  brewery        Brewery?      @relation(fields: [breweryId], references: [id])
  origin         Origin?       @relation(fields: [originId], references: [id])

  @@map("beers")
}

/// 店舗ビールメニュー
model BarBeerMenu {
  id          BigInt   @id @default(autoincrement())
  barId       BigInt   @map("bar_id")
  beerId      BigInt   @map("beer_id")
  price       Int?
  size        String?
  description String?
  imageUrl    String?  @map("image_url")
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)
  bar         Bar      @relation(fields: [barId], references: [id], onDelete: Cascade)
  beer        Beer     @relation(fields: [beerId], references: [id])

  @@map("bar_beer_menus")
}

/// 店舗フードメニュー
model BarFoodMenu {
  id          BigInt   @id @default(autoincrement())
  barId       BigInt   @map("bar_id")
  name        String
  price       Int?
  description String?
  imageUrl    String?  @map("image_url")
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)
  bar         Bar      @relation(fields: [barId], references: [id], onDelete: Cascade)

  @@map("bar_food_menus")
}

/// クーポン
model Coupon {
  id          BigInt       @id @default(autoincrement())
  barId       BigInt       @map("bar_id")
  title       String
  description String
  conditions  String?
  validFrom   DateTime?    @map("valid_from") @db.Timestamptz(6)
  validUntil  DateTime?    @map("valid_until") @db.Timestamptz(6)
  isActive    Boolean      @default(true) @map("is_active")
  createdAt   DateTime     @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime     @updatedAt @map("updated_at") @db.Timestamptz(6)
  bar         Bar          @relation(fields: [barId], references: [id], onDelete: Cascade)
  userCoupons UserCoupon[]

  @@map("coupons")
}

/// ユーザー取得済みクーポン
model UserCoupon {
  id         BigInt      @id @default(autoincrement())
  userId     String      @map("user_id") @db.Uuid
  couponId   BigInt      @map("coupon_id")
  obtainedAt DateTime    @default(now()) @map("obtained_at") @db.Timestamptz(6)
  usedAt     DateTime?   @map("used_at") @db.Timestamptz(6)
  isUsed     Boolean     @default(false) @map("is_used")
  coupon     Coupon      @relation(fields: [couponId], references: [id])
  user       UserProfile @relation(fields: [userId], references: [id])

  @@map("user_coupons")
}

/// 店舗記事
model Article {
  id          BigInt    @id @default(autoincrement())
  barId       BigInt    @map("bar_id")
  title       String
  body        String
  imageUrl    String?   @map("image_url")
  publishedAt DateTime? @map("published_at") @db.Timestamptz(6)
  isPublished Boolean   @default(false) @map("is_published")
  createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime  @updatedAt @map("updated_at") @db.Timestamptz(6)
  bar         Bar       @relation(fields: [barId], references: [id], onDelete: Cascade)

  @@map("articles")
}

/// ユーザー投稿
model Post {
  id         BigInt      @id @default(autoincrement())
  userId     String      @map("user_id") @db.Uuid
  barId      BigInt      @map("bar_id")
  body       String
  likeCount  Int         @default(0) @map("like_count")
  createdAt  DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime    @updatedAt @map("updated_at") @db.Timestamptz(6)
  postImages PostImage[]
  postLikes  PostLike[]
  bar        Bar         @relation(fields: [barId], references: [id], onDelete: Cascade)
  user       UserProfile @relation(fields: [userId], references: [id])

  @@map("posts")
}

/// 投稿画像
model PostImage {
  id        BigInt   @id @default(autoincrement())
  postId    BigInt   @map("post_id")
  imageUrl  String   @map("image_url")
  sortOrder Int      @default(0) @map("sort_order")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@map("post_images")
}

/// 投稿いいね
model PostLike {
  id        BigInt      @id @default(autoincrement())
  postId    BigInt      @map("post_id")
  userId    String      @map("user_id") @db.Uuid
  createdAt DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)
  post      Post        @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      UserProfile @relation(fields: [userId], references: [id])

  @@unique([postId, userId])
  @@map("post_likes")
}

/// フォロー関係
model UserFollowRelation {
  id         BigInt      @id @default(autoincrement())
  followerId String      @map("follower_id") @db.Uuid
  followeeId String      @map("followee_id") @db.Uuid
  createdAt  DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)
  followee   UserProfile @relation("Followee", fields: [followeeId], references: [id])
  follower   UserProfile @relation("Follower", fields: [followerId], references: [id])

  @@unique([followerId, followeeId])
  @@map("user_follow_relations")
}

/// お気に入り店舗
model FavoriteBar {
  id        BigInt      @id @default(autoincrement())
  userId    String      @map("user_id") @db.Uuid
  barId     BigInt      @map("bar_id")
  createdAt DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)
  bar       Bar         @relation(fields: [barId], references: [id], onDelete: Cascade)
  user      UserProfile @relation(fields: [userId], references: [id])

  @@unique([userId, barId])
  @@map("favorite_bars")
}

/// 閲覧履歴
model ViewHistory {
  id       BigInt      @id @default(autoincrement())
  userId   String      @map("user_id") @db.Uuid
  barId    BigInt      @map("bar_id")
  viewedAt DateTime    @default(now()) @map("viewed_at") @db.Timestamptz(6)
  bar      Bar         @relation(fields: [barId], references: [id], onDelete: Cascade)
  user     UserProfile @relation(fields: [userId], references: [id])

  @@unique([userId, barId])
  @@map("view_histories")
}

/// 通知
model Notification {
  id        BigInt      @id @default(autoincrement())
  userId    String      @map("user_id") @db.Uuid
  type      String
  title     String
  message   String
  linkUrl   String?     @map("link_url")
  isRead    Boolean     @default(false) @map("is_read")
  createdAt DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)
  user      UserProfile @relation(fields: [userId], references: [id])

  @@map("notifications")
}

/// ログイン履歴
model LoginHistory {
  id           BigInt      @id @default(autoincrement())
  userId       String      @map("user_id") @db.Uuid
  loggedInAt   DateTime    @default(now()) @map("logged_in_at") @db.Timestamptz(6)
  loginStatus  String      @map("login_status")
  ipAddress    String?     @map("ip_address")
  userAgent    String?     @map("user_agent")
  authProvider String?     @map("auth_provider")
  user         UserProfile @relation(fields: [userId], references: [id])

  @@map("login_histories")
}
