## 参照ルール（重要）

以下のファイルを必ず参照して実装を行うこと。

- @README.md
- @routing.md
- @wireframe.md
- @database.md

---

## ブランチ・Git 運用ルール

### 作業手順

- gh コマンドを使用すること
- 修正前に必ず develop ブランチから feature ブランチを作成する
  - 例: feature/profile-input
- 作業完了後は以下を必ず行うこと
  - コミット（git の命名規則に従う）
  - プッシュ
  - PR 作成（intoはdevelopとすること）

---

## コーディングルール（厳守）

### コメントルール

- コメントには Why not（なぜ別のやり方を採用しなかったか）のみを書くこと
- 以下は禁止
  - What
  - How
  - Why
- コードを読めば分かることは一切コメントしない

---

### デバッグ・品質

- デバッグコードは検証中のみ使用可
- 最終的なコードには残さないこと
- 作業終了前に必ず以下を実施すること
  - フォーマット実行
  - lint エラー確認
  - lint エラーがあれば必ず修正

---

## 実装方針

- 推測実装は禁止
- 無理に実装を進めないこと
- 仕様に詰まった場合は必ずユーザーに確認すること
- 「それっぽく動く」実装は禁止

---

## テスト・動作確認

- 受入条件に記載された内容は必ず Playwright MCP サーバーで検証する
- 動作確認が取れない場合、作業完了としてはならない
- 受入条件は、参照するIssue内に明示されるものとする

---

## 作業完了時の報告義務

作業完了時には、必ず以下を説明すること。

- 何を修正したのか
- なぜその修正が必要だったのか
- どのファイルを変更したのか
- 受入条件をどのように満たしたか

## コマンド実行に関する権限委譲ルール（重要）

Claude Code は、以下の方針に従ってコマンドを実行すること。

### 原則

- **安全で可逆なコマンド**については、ユーザーへの確認なしで実行してよい
- **不可逆・破壊的・外部影響が大きいコマンド**のみ、事前に確認を行うこと

### 確認不要なコマンド例（即時実行してよい）

以下は、失敗しても影響が限定的、または簡単に復旧可能なため、確認なしで実行してよい。

- `pnpm install`
- `pnpm add`
- `pnpm build`
- `pnpm dev`
- `pnpm lint`
- `pnpm lint:fix`
- `pnpm format`
- `pnpm test`
- `pnpm e2e`
- `npx prisma generate`
- `npx prisma migrate dev`
- `supabase start`
- `supabase stop`
- `supabase status`
- `git status`
- `git diff`
- `git log`
- `git branch`
- `git checkout -b <branch>`
- `git commit`
- `git push`
- `gh issue create`
- `gh pr create`

### 事前確認が必要なコマンド例

以下のコマンドを実行する場合は、必ずユーザーに確認すること。

- `rm -rf`
- `git reset --hard`
- `git rebase`
- `git push --force`
- `git branch -D`
- `prisma migrate reset`
- `supabase db reset`
- `.env` や設定ファイルの削除・上書き
- 外部サービスへの課金・公開設定変更を伴う操作
- 本番環境への直接デプロイ操作

### 不明な場合の判断基準

- **「ローカルで試して失敗してもやり直せるか？」**
  - YES → 確認不要
  - NO → 必ず確認

このルールに従い、不要な確認は行わず、作業を中断させないこと。

## 確認質問を行う際の説明義務（重要）

Claude Code がコマンド実行についてユーザーに確認を求める場合は、
**必ず以下をセットで説明すること。**

### 必須説明項目

確認を求める際は、必ず次の内容を明示すること。

1. **実行しようとしている具体的なコマンド**
   - 省略せず、実行予定のコマンド全文を記載すること

2. **そのコマンドで何をしようとしているのか**
   - どのファイル・設定・状態に影響するのか
   - 何を変更・作成・削除するのか

3. **なぜそのコマンドが必要なのか**
   - 現在の問題や目的との関係
   - 実行しない場合に起こる問題

4. **想定されるリスクや影響範囲**
   - ローカルのみか
   - Git 履歴・DB・環境設定への影響有無
   - 失敗時に復旧可能かどうか

### 禁止事項

- 「実行してもいいですか？」のみの質問は禁止
- 目的や影響が不明確なままの確認は禁止
- 判断材料をユーザーに丸投げする質問は禁止

### 判断基準

ユーザーが以下を即座に判断できる状態を作ること。

- 実行するかどうか
- 今でなく後で実行すべきか
- 別の方法を検討すべきか

この条件を満たさない確認は行ってはならない。

## ローカル開発サーバーの利用ルール（重要）

- 既にユーザーが起動しているローカル開発サーバー（localhost）が存在する場合は、
  **新たにサーバーを起動せず、必ずそのポートを利用すること**
- 勝手に `pnpm dev` や `npm run dev` を再実行してはならない
- 利用するポートが不明な場合のみ、ユーザーに確認すること

### 想定例

- 既に `http://localhost:3000` が起動している  
  → そのまま `localhost:3000` を使用する
- Playwright / MCP による E2E 検証も、既存の起動済みポートを対象に行う

### 禁止事項

- ユーザー確認なしで別ポート（3001, 5173 等）を勝手に立ち上げること
- 既存プロセスを停止・再起動すること

## コミット順序ルール（重要）

Claude Code は、作業完了時の処理順を **必ず以下の順序で実行すること**。

### 必須手順（順序厳守）

1. 作業ブランチの作成
2. 実装作業を完了する
3. **フォーマットを実行する**
   - 例: `pnpm format`
4. **lint を実行し、エラーがあれば必ず修正する**
   - 例: `pnpm lint`
   - 修正が発生した場合は再度フォーマットを実行する
5. **Playwright MCP サーバーで受入条件の動作確認を行う**
   - 受入条件を満たしていることを確認できない場合は作業完了としてはならない
   - テストの対象は、既に起動している localhost のポートを利用すること（別途ルールに従う）
6. **`git status` を確認し、差分が存在することを確認する**
7. **すべての差分を含めてコミットする**
   - フォーマット・lint 修正による差分を含めること
8. プッシュする
9. PR を作成する（into は develop）

### 禁止事項（厳守）

- Playwright MCP による受入確認 **前に** コミット・プッシュ・PR 作成を行うこと
- フォーマットや lint 修正 **後に** コミットせずに作業を終了すること
- コミット後に新たな差分を発生させ、そのまま放置すること

### 判断基準

- **受入条件を Playwright MCP で確認済みであること**
- **作業完了時点で `git status` が clean であること**
- 上記を満たさない状態で作業を終了してはならない