# Routing Specification - Beer Salon

Beer Salon の画面遷移・URL 設計をまとめたドキュメント。  
フロントは Next.js(App Router) を前提とする。

---

## 1. 共通ルール

- ドメイン: `https://beersalon.com`
- 未ログインでアクセス可能なページ
  - `/login`
  - `/signup`
  - `/password/reset`
- それ以外のページはすべてログイン必須
  - 未ログイン時は `/login` へリダイレクト
- ログインユーザー向けページでは、原則として以下を共通レイアウトとして使用する
  - ヘッダー: ロゴ / マイページリンク / 通知ボタン / ログアウト
  - フッター: お気に入りバー / タイムライン / 投稿 / 閲覧履歴

---

## 2. ルート一覧（ユーザー画面）

### 2-1. 認証周り

#### 2-1-1. ログインページ

- Path: `/login`
- 認証: 不要（ログイン中にアクセスした場合は `/` へリダイレクト）
- 役割:
  - メールアドレス＋パスワードでログイン
  - 新規登録ページ / パスワード再設定への導線
- UI 要素:
  - メールアドレス（テキストボックス）
  - パスワード（テキストボックス）
  - 「新規登録はこちら」リンク → `/signup`
  - 「パスワードをお忘れの方」リンク → `/password/reset`

#### 2-1-2. 新規登録ページ

- Path: `/signup`
- 認証: 不要
- 役割:
  - メール＋パスワード or Google / X でのアカウント作成
  - 登録後、確認メールを送信し、メール内リンクからプロフィール入力へ遷移
- UI 要素:
  - メールアドレス入力（バリデーション: メール形式）
  - パスワード入力（バリデーション: 英大小文字＋数字＋記号 など）
  - 「Googleで登録」ボタン
  - 「Xで登録」ボタン
  - 「登録」ボタン → メール送信後に完了画面（または「メールを確認してください」メッセージ）

#### 2-1-3. プロフィール入力ページ

- Path: `/signup/profile`
- 認証: メールリンク経由でのみアクセス可（トークン / 一時セッション）
- 役割:
  - 初回プロフィール情報の入力
- UI 要素:
  - 姓 / 名
  - ニックネーム
  - 生年月日（プルダウン）
  - 性別（プルダウン）
  - お住まいの都道府県（プルダウン）
  - 「登録」ボタン → `/signup/confirm` へ

#### 2-1-4. 登録内容確認ページ

- Path: `/signup/confirm`
- 認証: `/signup/profile` と同様（一時セッション前提）
- 役割:
  - 入力済みプロフィールの確認
- UI 要素:
  - 姓 / 名 / ニックネーム / 生年月日 / 性別 / 都道府県（テキスト表示）
  - 「この内容で登録する」ボタン → 登録確定後 `/`（トップページ）へ遷移

#### 2-1-5. パスワード再登録ページ（リセット）

- Path: `/password/reset`
- 認証: 不要（メールリンク経由でトークンチェック）
- 役割:
  - パスワード再設定
- UI 要素:
  - 新しいパスワード
  - 新しいパスワード（確認用）
  - いずれも強度チェックあり

---

### 2-2. 共通レイアウト構成要素

#### 2-2-1. 共通ヘッダー（ログイン後のみ表示）

- 各ページ共通レイアウトの一部として実装
- 含まれる要素:
  - サービスロゴ（クリックで `/` へ）
  - マイページリンク → `/mypage`
  - 通知ボタン → `/notifications`
  - ログアウト（押下でセッション破棄 → `/login`）

#### 2-2-2. 共通フッター（ログイン後のみ表示）

- 各ページ共通レイアウトの一部として実装
- 含まれる要素:
  - 「お気に入りバー」 → `/favorites/bars`
  - 「タイムライン」 → `/timeline`
  - 「投稿」 → `/posts/new`
  - 「閲覧履歴」 → `/history/bars`

---

### 2-3. 検索・店舗関連

#### 2-3-1. トップページ（検索ページ）

- Path: `/`
- 認証: 必須
- 役割:
  - 店舗検索のメイン画面
  - Google Maps と店舗一覧コンポーネントを同一画面で表示
- 主な UI:
  - 検索バー
    - テキスト検索: 店名・説明・タグなど全文検索
    - 市町村フィルタ（選択すると検索バーに反映 or クエリパラメータ更新）
    - ビールカテゴリフィルタ（同上）
    - 検索ボタン（虫眼鏡） → ページ遷移せずに下部の店舗一覧コンポーネントを更新
  - Google Maps 表示
    - デフォルトは現在地近辺
    - 検索条件変更でマップ中心位置も更新
  - 店舗一覧コンポーネント（同一ページ内に埋め込み）

- 推奨クエリパラメータ:
  - `q`: フリーワード
  - `city`: 市町村名
  - `cat`: ビールカテゴリID など

#### 2-3-2. 店舗一覧コンポーネント（埋め込み）

- Path: `/(同一ページ内コンポーネント)`
- 別ページにはせず、`/` の下部コンポーネントとして実装
- 役割:
  - 検索結果の店舗リスト表示
- 各行要素:
  - 画像（最大4枚のサムネイル）: 外観 / 店内 / ビール / 料理
  - 店舗名
  - 都道府県
  - 市町村
  - クリック or タップで `/bars/[barId]` へ

#### 2-3-3. 店舗詳細ページ

- Path: `/bars/[barId]`
- 認証: 必須
- 役割:
  - 店舗の詳細情報、メニュー、クーポン、関連投稿をタブで表示

- 共通エリア
  - 店舗名
  - お気に入りボタン
  - このお店について投稿する → `/posts/new`
- タブ構成:

1. トップタブ
   - PR 文
   - 営業時間
   - 定休日
   - 交通手段・アクセス
   - 電話番号（スマホならタップで電話アプリ起動）
   - 住所
   - ホームページリンク

2. メニュータブ
   - Beers（上半分）
     - メニュー名
     - 説明文
     - 写真
     - 醸造所
     - 産地
   - Meals（下半分）
     - 料理名・説明・写真など

3. タグ付けされた投稿タブ
   - この店に紐づくユーザー投稿一覧
   - 投稿者アカウント → `/users/[userId]`
   - 投稿写真
   - 投稿本文
   - タグ → タグ検索に遷移（実装方針により `/` の検索パラメータ更新など）

4. お店からの投稿タブ
   - 店舗オーナーが投稿したブログ・お知らせ記事一覧
   - 各記事 → `/articles/[articleId]`

5. クーポンタブ
   - 店舗が発行しているクーポン一覧
   - 見出し / 内容文 / 取得条件表示

---

### 2-4. 記事・コンテンツ

#### 2-4-1. 記事ページ

- Path: `/articles/[articleId]`
- 認証: 必須
- 役割:
  - 店舗オーナーの記事、新R25形式のインタビュー記事等の詳細表示
- UI:
  - 記事タイトル
  - 記事本文
  - 必要に応じて店舗へのリンク（`/bars/[barId]`）

---

### 2-5. ユーザー関連

#### 2-5-1. マイページ

- Path: `/mypage`
- 認証: 必須
- 役割:
  - 自分のプロフィール周りのハブ画面
  - 投稿とクーポンをタブで切り替えて表示
- UI:
  - フォロー数（リンク）→ `/mypage/following`
  - フォロワー数（リンク）→ `/mypage/followers`
  - タブ構成:
    - 投稿タブ: 自分の投稿一覧を表示
    - 持っているクーポンタブ: 取得済みクーポン一覧を表示

#### 2-5-2. 自分のフォロー一覧

- Path: `/mypage/following`
- 認証: 必須
- 役割:
  - 自分がフォローしているユーザー一覧
- 各行:
  - ユーザー情報 → `/users/[userId]`

#### 2-5-3. 自分のフォロワー一覧

- Path: `/mypage/followers`
- 認証: 必須
- 役割:
  - 自分をフォローしているユーザー一覧
- 各行:
  - ユーザー情報 → `/users/[userId]`


---

### 2-6. 他ユーザー関連

#### 2-6-1. 他人のアカウント詳細ページ

- Path: `/users/[userId]`
- 認証: 必須
- 役割:
  - 他ユーザーのプロフィール・投稿への入口
- UI:
  - フォロー数 → `/users/[userId]/following`
  - フォロワー数 → `/users/[userId]/followers`
  - 投稿一覧 → `/users/[userId]/posts`
  - フォローボタン / フォロー解除ボタン

#### 2-6-2. 他人のフォロー一覧

- Path: `/users/[userId]/following`
- 認証: 必須

#### 2-6-3. 他人のフォロワー一覧

- Path: `/users/[userId]/followers`
- 認証: 必須

#### 2-6-4. 他人の投稿一覧

- Path: `/users/[userId]/posts`
- 認証: 必須
- 役割:
  - 指定ユーザーの投稿一覧
- 各行:
  - 投稿者 → `/users/[userId]`
  - 投稿写真
  - 投稿本文
  - タグ → 検索へ

---

### 2-7. タイムライン・投稿

#### 2-7-1. タイムラインページ

- Path: `/timeline`
- 認証: 必須
- 役割:
  - 自分がフォローしているユーザーの投稿を時系列で表示
- 各投稿:
  - 投稿者 → `/users/[userId]`
  - 投稿写真
  - 投稿本文
  - タグ → 検索（`/` のクエリ更新など）

#### 2-7-2. お気に入りバー一覧ページ

- Path: `/favorites/bars`
- 認証: 必須
- 役割:
  - ユーザーがお気に入り登録したバーの一覧
- 各行:
  - 店舗画像（最大4枚）
  - 店名
  - 都道府県
  - 市町村
  - クリックで `/bars/[barId]`

#### 2-7-3. 投稿作成ページ

- Path: `/posts/new`
- 認証: 必須
- 役割:
  - バーに紐づく投稿を新規作成
- UI:
  - 投稿本文（テキストエリア）
  - 写真アップロード（最大4枚）
  - 店名タグ（必須：バー選択 UI or 検索 & 選択）
  - 投稿ボタン（投稿完了後、店舗詳細 or タイムラインへ戻る）

---

### 2-8. 閲覧履歴・通知

#### 2-8-1. 閲覧履歴ページ

- Path: `/history/bars`
- 認証: 必須
- 役割:
  - 最近閲覧したバーの履歴を一覧表示
- 各行:
  - 店舗画像（最大4枚）
  - 店名
  - 都道府県
  - 市町村
  - クリックで `/bars/[barId]`

#### 2-8-2. 通知一覧ページ

- Path: `/notifications`
- 認証: 必須
- 役割:
  - 以下のような通知を一覧表示
    - 自分の投稿に「いいね」やコメントがついた
    - お気に入りのお店が新しい記事を投稿した
    - フォローされた など
- 各行:
  - 通知種別
  - 簡単なテキスト
  - 関連リンク（投稿・ユーザー・店舗など）

---

## 3. 今後の拡張候補（メモ）

- タグ検索専用ページ `/tags/[tagName]`
- 言語切り替え（日本語 / 英語）用のクエリ or サブパス
- 店舗側管理画面（別サブドメイン `owner.beersalon.com` 想定 など）

